{"ast":null,"code":"const express = require(\"express\");\nconst router = express.Router();\nconst db = require(\"../config/db\");\nconst bcrypt = require(\"bcrypt\");\n\n// Login endpoint\nrouter.post(\"/\", async (req, res) => {\n  const {\n    email,\n    password\n  } = req.body;\n\n  // Admin check\n  if (email === \"admin@mostafa.com\" && password === \"Admin123!\") {\n    return res.json({\n      name: \"Admin\",\n      email,\n      role: \"admin\"\n    });\n  }\n  try {\n    // Check if user already exists\n    const [rows] = await db.query(\"SELECT * FROM users WHERE email = ?\", [email]);\n    let name = email.split(\"@\")[0]; // default name if not provided\n\n    if (rows.length === 0) {\n      // New customer → save to DB\n      const hashed = await bcrypt.hash(password, 10);\n      const [result] = await db.query(\"INSERT INTO users (name, email, password) VALUES (?, ?, ?)\", [name, email, hashed]);\n      console.log(\"New customer saved:\", email);\n    } else {\n      // Existing user → use existing name\n      name = rows[0].name;\n    }\n    res.json({\n      name,\n      email,\n      role: \"customer\"\n    });\n  } catch (err) {\n    console.error(err);\n    res.status(500).json({\n      error: \"Server error\"\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["express","require","router","Router","db","bcrypt","post","req","res","email","password","body","json","name","role","rows","query","split","length","hashed","hash","result","console","log","err","error","status","module","exports"],"sources":["C:/Users/Mostafa Diab/Downloads/MOSTAFA_RESTAURANT/frontend/src/pages/Login.jsx"],"sourcesContent":["const express = require(\"express\");\r\nconst router = express.Router();\r\nconst db = require(\"../config/db\");\r\nconst bcrypt = require(\"bcrypt\");\r\n\r\n// Login endpoint\r\nrouter.post(\"/\", async (req, res) => {\r\n  const { email, password } = req.body;\r\n\r\n  // Admin check\r\n  if (email === \"admin@mostafa.com\" && password === \"Admin123!\") {\r\n    return res.json({ name: \"Admin\", email, role: \"admin\" });\r\n  }\r\n\r\n  try {\r\n    // Check if user already exists\r\n    const [rows] = await db.query(\"SELECT * FROM users WHERE email = ?\", [email]);\r\n\r\n    let name = email.split(\"@\")[0]; // default name if not provided\r\n\r\n    if (rows.length === 0) {\r\n      // New customer → save to DB\r\n      const hashed = await bcrypt.hash(password, 10);\r\n      const [result] = await db.query(\r\n        \"INSERT INTO users (name, email, password) VALUES (?, ?, ?)\",\r\n        [name, email, hashed]\r\n      );\r\n      console.log(\"New customer saved:\", email);\r\n    } else {\r\n      // Existing user → use existing name\r\n      name = rows[0].name;\r\n    }\r\n\r\n    res.json({ name, email, role: \"customer\" });\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ error: \"Server error\" });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAMC,EAAE,GAAGH,OAAO,CAAC,cAAc,CAAC;AAClC,MAAMI,MAAM,GAAGJ,OAAO,CAAC,QAAQ,CAAC;;AAEhC;AACAC,MAAM,CAACI,IAAI,CAAC,GAAG,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACnC,MAAM;IAAEC,KAAK;IAAEC;EAAS,CAAC,GAAGH,GAAG,CAACI,IAAI;;EAEpC;EACA,IAAIF,KAAK,KAAK,mBAAmB,IAAIC,QAAQ,KAAK,WAAW,EAAE;IAC7D,OAAOF,GAAG,CAACI,IAAI,CAAC;MAAEC,IAAI,EAAE,OAAO;MAAEJ,KAAK;MAAEK,IAAI,EAAE;IAAQ,CAAC,CAAC;EAC1D;EAEA,IAAI;IACF;IACA,MAAM,CAACC,IAAI,CAAC,GAAG,MAAMX,EAAE,CAACY,KAAK,CAAC,qCAAqC,EAAE,CAACP,KAAK,CAAC,CAAC;IAE7E,IAAII,IAAI,GAAGJ,KAAK,CAACQ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEhC,IAAIF,IAAI,CAACG,MAAM,KAAK,CAAC,EAAE;MACrB;MACA,MAAMC,MAAM,GAAG,MAAMd,MAAM,CAACe,IAAI,CAACV,QAAQ,EAAE,EAAE,CAAC;MAC9C,MAAM,CAACW,MAAM,CAAC,GAAG,MAAMjB,EAAE,CAACY,KAAK,CAC7B,4DAA4D,EAC5D,CAACH,IAAI,EAAEJ,KAAK,EAAEU,MAAM,CACtB,CAAC;MACDG,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEd,KAAK,CAAC;IAC3C,CAAC,MAAM;MACL;MACAI,IAAI,GAAGE,IAAI,CAAC,CAAC,CAAC,CAACF,IAAI;IACrB;IAEAL,GAAG,CAACI,IAAI,CAAC;MAAEC,IAAI;MAAEJ,KAAK;MAAEK,IAAI,EAAE;IAAW,CAAC,CAAC;EAC7C,CAAC,CAAC,OAAOU,GAAG,EAAE;IACZF,OAAO,CAACG,KAAK,CAACD,GAAG,CAAC;IAClBhB,GAAG,CAACkB,MAAM,CAAC,GAAG,CAAC,CAACd,IAAI,CAAC;MAAEa,KAAK,EAAE;IAAe,CAAC,CAAC;EACjD;AACF,CAAC,CAAC;AAEFE,MAAM,CAACC,OAAO,GAAG1B,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}